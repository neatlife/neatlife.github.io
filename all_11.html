<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  xiaolin's blog
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="xiaolin's blog" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <link rel="shortcut icon" href="favicon.ico">
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:neatlifecoco.com ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">about</a></li>
        
        <li id=""><a target="_self" href="all.html">blog</a></li>
        
        <li id=""><a target="_self" href="archives.html">archive</a></li>
        
        <li id=""><a target="_self" href="tools.html">tools</a></li>
        
        <li id=""><a target="_self" href="pro.html">pros</a></li>
        
        <li id=""><a target="_self" href="pub.html">press</a></li>
        
        <li id=""><a target="_self" href="paper.html">paper</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="https://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; xiaolin's blog</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">about</a></li>
        
        <li><a target="_self" href="all.html">blog</a></li>
        
        <li><a target="_self" href="archives.html">archive</a></li>
        
        <li><a target="_self" href="tools.html">tools</a></li>
        
        <li><a target="_self" href="pro.html">pros</a></li>
        
        <li><a target="_self" href="pub.html">press</a></li>
        
        <li><a target="_self" href="paper.html">paper</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="macios.html">mac&ios</a></li>
        
            <li><a href="lc.html">leetcode</a></li>
        
            <li><a href="security.html">安全</a></li>
        
            <li><a href="business.html">业务</a></li>
        
            <li><a href="source-code.html">源码分析</a></li>
        
            <li><a href="redis.html">Redis</a></li>
        
            <li><a href="apache-nginx.html">Apache/Nginx</a></li>
        
            <li><a href="spring-boot.html">Spring Boot</a></li>
        
            <li><a href="pm.html">项目管理</a></li>
        
            <li><a href="sql.html">SQL</a></li>
        
            <li><a href="job-scheduler.html">任务调度</a></li>
        
            <li><a href="design-pattern.html">设计模式</a></li>
        
            <li><a href="mq.html">消息队列</a></li>
        
            <li><a href="rpc.html">RPC</a></li>
        
            <li><a href="laravel.html">LARAVEL</a></li>
        
            <li><a href="tcp-ip.html">TCP/IP</a></li>
        
            <li><a href="uml.html">UML</a></li>
        
            <li><a href="service-mesh.html">SERVICE MESH</a></li>
        
            <li><a href="ci-cd.html">CI/CD</a></li>
        
            <li><a href="ops.html">OPS</a></li>
        
            <li><a href="linux.html">LINUX</a></li>
        
            <li><a href="system-programming.html">系统编程</a></li>
        
            <li><a href="aws.html">AWS</a></li>
        
            <li><a href="lua.html">LUA</a></li>
        
            <li><a href="git.html">GIT</a></li>
        
            <li><a href="js.html">js</a></li>
        
            <li><a href="java.html">JAVA</a></li>
        
            <li><a href="monitor.html">监控</a></li>
        
            <li><a href="vim.html">VIM</a></li>
        
            <li><a href="php.html">PHP</a></li>
        
            <li><a href="openresty.html">OpenResty</a></li>
        
            <li><a href="swoole.html">SWOOLE</a></li>
        
            <li><a href="ons.html">消息队列</a></li>
        
            <li><a href="gdb.html">GDB</a></li>
        
            <li><a href="specification.html">规范</a></li>
        
            <li><a href="3-minutes.html">三分钟系列</a></li>
        
            <li><a href="1-pic.html">一图胜千言</a></li>
        
            <li><a href="account-system.html">帐号系统</a></li>
        
            <li><a href="interview.html">面试题</a></li>
        
            <li><a href="yii.html">Yii/Yii2</a></li>
        
            <li><a href="python.html">python</a></li>
        
            <li><a href="go.html">GO</a></li>
        
            <li><a href="ml.html">机器学习</a></li>
        
            <li><a href="emacs.html">emacs</a></li>
        
            <li><a href="bi.html">商业智能</a></li>
        
            <li><a href="mac.html">mac</a></li>
        
            <li><a href="editor.html">编辑器</a></li>
        
            <li><a href="productive-soft.html">生产力工具</a></li>
        
            <li><a href="driver-license.html">驾照</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="15582747911822.html">
                
                  <h1>一图胜千言-开源项目源码目录结构</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h2 id="toc_0">php和swoole目录结构</h2>

<p><img src="media/15582747911822/15582747932401.jpg" alt=""/></p>


                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                   <a href="15582747911822.html">Read more</a>&nbsp;&nbsp; 
                    <span class="date">2017/5/19</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='1-pic.html'>一图胜千言</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15582832387211.html">
                
                  <h1>图片16:9缩放</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<pre><code class="language-php">function crop_image($image) {
    list($w_i, $h_i, $type) = getimagesize($image);
 
    $w_o = $w_i;
    $h_o = 9 * $w_o / 16;
 
    if ($h_i &lt; $h_o) {
        $h_o = $h_i;
        $w_o = 16 * $h_o / 9;
    }
 
    $x_o = $w_i - $w_o;
    $y_o = $h_i - $h_o;
 
    $types = array(&quot;&quot;, &quot;gif&quot;, &quot;jpeg&quot;, &quot;png&quot;);
    $ext = $types[$type];
    if ($ext) {
      $func = &#39;imagecreatefrom&#39;.$ext;
      $img_i = $func($image);
    } else {
      echo &#39;Incorrect image&#39;;
      return false;
    }
    if ($x_o + $w_o &gt; $w_i) $w_o = $w_i - $x_o;
    if ($y_o + $h_o &gt; $h_i) $h_o = $h_i - $y_o;
    $img_o = imagecreatetruecolor($w_o, $h_o);
    imagecopy($img_o, $img_i, 0, 0, $x_o/2, $y_o/2, $w_o, $h_o);
    $func = &#39;image&#39;.$ext;
    return $func($img_o, $image);  
}
 
crop_image(&quot;screen.png&quot;);
</code></pre>

<h2 id="toc_0">改良后的代码（解决获取图片宽高错误）</h2>

<pre><code class="language-php">function crop_image($image) {
    $img = imagecreatefromstring(file_get_contents($image));
    $exif = @exif_read_data($image);
    if( ! empty($exif[&#39;Orientation&#39;])) {
        switch($exif[&#39;Orientation&#39;]) {
            case 8:
                $img = imagerotate($img, 90, 0);
                break;
            case 3:
                $img = imagerotate($img, 180, 0);
                break;
            case 6:
                $img = imagerotate($img, -90, 0);
                break;
        }
        list($_, $_, $type) = getimagesize($image);
        $types = array(&quot;&quot;, &quot;gif&quot;, &quot;jpeg&quot;, &quot;png&quot;);
        $ext = $types[$type];
        $func = &#39;image&#39;.$ext;
        $func($img, $image);
    }
    list($w_i, $h_i, $type) = getimagesize($image);
 
    $w_o = $w_i;
    $h_o = 9 * $w_o / 16;
 
    if ($h_i &lt; $h_o) {
        $h_o = $h_i;
        $w_o = 16 * $h_o / 9;
    }
 
    $x_o = $w_i - $w_o;
    $y_o = $h_i - $h_o;
 
    $types = array(&quot;&quot;, &quot;gif&quot;, &quot;jpeg&quot;, &quot;png&quot;);
    $ext = $types[$type];
    if ($ext) {
      $func = &#39;imagecreatefrom&#39;.$ext;
      $img_i = $func($image);
    } else {
      echo &#39;Incorrect image&#39;;
      return false;
    }
    if ($x_o + $w_o &gt; $w_i) $w_o = $w_i - $x_o;
    if ($y_o + $h_o &gt; $h_i) $h_o = $h_i - $y_o;
    $img_o = imagecreatetruecolor($w_o, $h_o);
    imagecopy($img_o, $img_i, 0, 0, $x_o/2, $y_o/2, $w_o, $h_o);
    $func = &#39;image&#39;.$ext;
    return $func($img_o, $image);
}
 
crop_image(&quot;1.jpg&quot;);
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/4/15</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='php.html'>PHP</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15866177780160.html">
                
                  <h1>北京联通光猫内网路由器端口转发</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h2 id="toc_0">0x01 登录光猫</h2>

<p>一般地址是 192.168.1.1 用户名密码参考光猫背面<br/>
<img src="media/15866177780160/15866185805589.jpg" alt="" style="width:889px;"/></p>

<h2 id="toc_1">0x02 配置DMZ-将报文发给内网路由器</h2>

<p><img src="media/15866177780160/15866178776267.jpg" alt="" style="width:869px;"/></p>

<h2 id="toc_2">0x03 在路由器上配置端口转发</h2>

<p><img src="media/15866177780160/15866187031056.jpg" alt="" style="width:1017px;"/></p>

<p>然后就可以通过外网ip地址+2222端口访问内网ip的22端口了</p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/4/11</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='productive-soft.html'>生产力工具</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15582831996170.html">
                
                  <h1>防止表单重复提交</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<pre><code class="language-javascript">var submited = false;
$(&#39;#submit&#39;).click(function(e) {
    if (submited) {
        return;
    }
    submited = true;
    // 自定义代码
});
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/4/10</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='js.html'>js</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15582831047992.html">
                
                  <h1>Laravel中RBAC权限控制核心技术要点</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p><img src="media/15582831047992/15582831096866.jpg" alt=""/></p>

<h2 id="toc_0">SQL设计如下</h2>

<pre><code class="language-sql">DROP SCHEMA IF EXISTS `mydb` ;
-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;
-- -----------------------------------------------------
-- Table `mydb`.`admin`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`admin` ;
CREATE TABLE IF NOT EXISTS `mydb`.`admin` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(16) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;
CREATE UNIQUE INDEX `username_UNIQUE` ON `mydb`.`admin` (`username` ASC);
  
-- -----------------------------------------------------
-- Table `mydb`.`role`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`role` ;
CREATE TABLE IF NOT EXISTS `mydb`.`role` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(10) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;
CREATE UNIQUE INDEX `name_UNIQUE` ON `mydb`.`role` (`name` ASC);
  
-- -----------------------------------------------------
-- Table `mydb`.`role_admin`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`role_admin` ;
CREATE TABLE IF NOT EXISTS `mydb`.`role_admin` (
  `admin_id` INT UNSIGNED NOT NULL,
  `role_id` INT UNSIGNED NOT NULL)
ENGINE = InnoDB;
  
-- -----------------------------------------------------
-- Table `mydb`.`permission`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`permission` ;
CREATE TABLE IF NOT EXISTS `mydb`.`permission` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(10) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;
CREATE UNIQUE INDEX `name_UNIQUE` ON `mydb`.`permission` (`name` ASC);
  
-- -----------------------------------------------------
-- Table `mydb`.`role_permission`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`role_permission` ;
CREATE TABLE IF NOT EXISTS `mydb`.`role_permission` (
  `role_id` INT UNSIGNED NOT NULL,
  `permission_id` INT UNSIGNED NOT NULL)
ENGINE = InnoDB;
</code></pre>

<h2 id="toc_1">管理员模型</h2>

<pre><code class="language-php">public function roles()
{
    return $this-&gt;belongsToMany(&#39;App\Role&#39;, &#39;role_admin&#39;, &#39;admin_id&#39;, &#39;role_id&#39;);
}
public function hasRole($roleName)
{
    foreach($this-&gt;roles()-&gt;get() as $role) {
        if ($role-&gt;name == $roleName) {
            return true;
        }
    }
    return false;
}
public function hasPermission($permissionName)
{
    foreach($this-&gt;roles()-&gt;get() as $role) {
        foreach($role-&gt;permissions as $permission) {
            if ($permission-&gt;name == $permissionName) {
                return true;
            }
        }
    }
    return false;
}
</code></pre>

<h2 id="toc_2">角色模型</h2>

<pre><code class="language-php">&lt;?php
namespace App;
use Illuminate\Database\Eloquent\Model;
class Role extends Model
{
    //
    protected $table = &#39;role&#39;;
    protected $fillable = [&#39;name&#39;, &#39;display_name&#39;];
    protected static $list = null;
    public static function getList($refresh = false)
    {
        if ($refresh || is_null(self::$list)) {
            self::$list = static::with(&#39;permissions&#39;)-&gt;get();
        }
        return self::$list;
    }
    public static function getById($roleId)
    {
        $key = static::getList()-&gt;search(function($role) use ($roleId) {
            return $role-&gt;id == $roleId;
        });
        return $key ? static::getList()-&gt;get($key) : null;
    }
    public function permissions()
    {
        return $this-&gt;belongsToMany(&#39;App\Permission&#39;, &#39;role_permission&#39;, &#39;role_id&#39;, &#39;permission_id&#39;);
    }
}
</code></pre>

<h2 id="toc_3">权限模型</h2>

<pre><code class="language-php">&lt;?php
namespace App;
use App\Role;
use Illuminate\Database\Eloquent\Model;
class Permission extends Model
{
    //
    protected $table = &#39;permission&#39;;
    protected $fillable = [&#39;name&#39;, &#39;display_name&#39;];
    public function role()
    {
        foreach(Role::getList() as $role) {
            foreach($role-&gt;permissions as $permission) {
                if ($permission-&gt;id == $this-&gt;id) {
                    return $role;
                }
            }
        }
        return false;
    }
}
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/3/29</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='laravel.html'>LARAVEL</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15582830498305.html">
                
                  <h1>nginx的fast_cgi缓存配置</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<pre><code class="language-conf">fastcgi_cache_path /var/cache levels=1:2 keys_zone=MYCACHE:100m inactive=60m;
fastcgi_cache_key &quot;$scheme$request_method$host$request_uri&quot;;

server {
    server_name test;
    root /webroot/test; ## &lt;-- Your only path reference.
    listen 80;



    #Cache everything by default
    set $no_cache 0;

    #Don&#39;t cache POST requests
    if ($request_method = POST)
    {
        set $no_cache 1;
    }

    #Don&#39;t cache if the URL contains a query string
    if ($query_string != &quot;&quot;)
    {
        set $no_cache 1;
    }

    #Don&#39;t cache the following URLs
    if ($request_uri ~* &quot;/(administrator/|login.php)&quot;)
    {
        set $no_cache 1;
    }

    #Don&#39;t cache if there is a cookie called PHPSESSID
    if ($http_cookie = &quot;PHPSESSID&quot;)
    {
        set $no_cache 1;
    }



    location ~ &#39;\.php$&#39; {
        fastcgi_split_path_info ^(.+?\.php)(|/.*)$;
        include fastcgi_params;
        # Block httpoxy attacks. See https://httpoxy.org/.
        fastcgi_param HTTP_PROXY &quot;&quot;;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param PATH_INFO $fastcgi_path_info;
        fastcgi_param QUERY_STRING $query_string;
        fastcgi_intercept_errors on;
               fastcgi_pass backend;

        fastcgi_cache MYCACHE;
        fastcgi_cache_valid 200 60m;
        fastcgi_cache_bypass $no_cache;
        fastcgi_no_cache $no_cache;
        add_header X-Cache $upstream_cache_status;
    }
}
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/3/28</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='apache-nginx.html'>Apache/Nginx</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15582827924478.html">
                
                  <h1>面试题-在页面上显示一张图片</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h2 id="toc_0">项目需求</h2>

<p>在页面上显示一张图片，此图片是由多个部分组成：背景，小岛和海鸥。根据传入参数的不同，小岛和海鸥在背景中的位置将可以变化。</p>

<pre><code class="language-php">&lt;?php

class pic
{
    private $_url;

    public function __get($name)
    {
        return $this-&gt;$name;
    }

    public function __set($name,$value)
    {
        return $this-&gt;$name = $value;
    }
}
interface layer
{
    public function loadPic(pic $pic);
}

class background implements layer
{
    private $_z = 0;
    private $_pic;
    private $_width;
    private $_height;
    private $_html;

    public function loadPic(pic $pic)
    {
        $this-&gt;_pic = $pic;
    }

    public function __get($name)
    {
        return $this-&gt;$name;
    }

    public function __set($name,$value)
    {
        return $this-&gt;$name = $value;
    }

    public function generateHtml()
    {
        $this-&gt;_html = &quot;&lt;img src=&#39;{$this-&gt;_pic-&gt;_url}&#39; width=&#39;{$this-&gt;_width}&#39; height=&#39;{$this-&gt;_height}&#39; style=&#39;z-index: {$this-&gt;_z};&#39;&gt;&quot;;
        return $this-&gt;_html;
    }
}

abstract class onLayer implements layer
{
    private $_x;
    private $_y;
    private $_z;
    private $_pic;
    private $_width;
    private $_height;
    private $_html;
    private $_downLayer;

    public function loadPic(pic $pic)
    {
        $this-&gt;_pic = $pic;
    }

    public function __get($name)
    {
        return $this-&gt;$name;
    }

    public function __set($name,$value)
    {
        return $this-&gt;$name = $value;
    }

    abstract public function on(layer $newLayer);

    public function generateHtml()
    {
        $this-&gt;_html = $this-&gt;_downLayer-&gt;_html.&quot;&lt;img src=&#39;{$this-&gt;_pic-&gt;_url}&#39; width=&#39;{$this-&gt;_width}&#39; height=&#39;{$this-&gt;_height}&#39; style=&#39;z-index: {$this-&gt;_z}; position: absolute; left: {$this-&gt;_x}px; top: {$this-&gt;_y}px;&#39;&gt;&quot;;
        return $this-&gt;_html;
    }
}

class island extends onLayer
{
    public function on(layer $downLayer)
    {
        $this-&gt;_width = 100;
        $this-&gt;_height = 50;
        $this-&gt;_downLayer = $downLayer;
        $this-&gt;_z = $downLayer-&gt;_z + 20;
    }
}

class bird extends onLayer
{
    public function on(layer $downLayer)
    {
        $this-&gt;_x = 20;
        $this-&gt;_y = 30;
        $this-&gt;_width = 20;
        $this-&gt;_height = 20;
        $this-&gt;_downLayer = $downLayer;
        $this-&gt;_z = $downLayer-&gt;_z + 21;
    }
}

$inland_x = isset($_REQUEST[&#39;_x&#39;]) ? $_REQUEST[&#39;_x&#39;] : 0;
$inland_y = isset($_REQUEST[&#39;_y&#39;]) ? $_REQUEST[&#39;_y&#39;] : 0;
</code></pre>

<h2 id="toc_1">No.1</h2>

<p>开始写代码，显示由背景、小岛和海鸥三个图片组合而成的背景图</p>

<pre><code class="language-php">/*
背景图片为: sea.jpg
岛的图片为: island.jpg
鸟的图片为: bird.jpg
*/
$pic = new pic();
$pic-&gt;_url = &#39;sea.jpg&#39;;
$background = new background();
$background-&gt;loadPic($pic);
$background-&gt;_width = &#39;400&#39;;
$background-&gt;_height = &#39;300&#39;;
$background-&gt;generateHtml();


$pic1 = new pic();
$pic1-&gt;_url = &#39;island.jpg&#39;;
$island = new island();
$island-&gt;loadPic($pic1);
$island-&gt;_x = $inland_x;
$island-&gt;_y = $inland_y;
$island-&gt;on($background);
$island-&gt;generateHtml();

$pic2 = new pic();
$pic2-&gt;_url = &#39;bird.jpg&#39;;
$bird = new bird();
$bird-&gt;loadPic($pic2);
$bird-&gt;on($island);
$bird-&gt;_x = $inland_x;
$bird-&gt;_y = $inland_y;


$seaPic = $bird-&gt;generateHtml();
echo $seaPic;
//end_code

?&gt;

&lt;form action=&quot;#&quot; method=&quot;post&quot; style=&quot;&quot;&gt;
    &lt;input name=&quot;_x&quot; type=&quot;text&quot;&gt;
    &lt;input name=&quot;_y&quot; type=&quot;text&quot;&gt;
    &lt;input type=&quot;submit&quot;&gt;
&lt;/form&gt;
</code></pre>

<h3 id="toc_2">三张素材图</h3>

<p><img src="media/15582827924478/15582829284439.jpg" alt=""/></p>

<p><img src="media/15582827924478/15582829374939.jpg" alt=""/></p>

<p><img src="media/15582827924478/15582829435737.jpg" alt=""/></p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/3/15</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='interview.html'>面试题</a></span>
          				  
          					    <span class="posted-in"><a href='php.html'>PHP</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15582827040043.html">
                
                  <h1>Laravel中利用中间表处理多对多的关系</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>今天谈谈Laravel中非常有用但是又非常难以理解的特性：中间表</p>

<p>拿博客和博客的标签举例：一个博客有多个标签，形成了多对多的关系，使用中间表来表示这种关系，数据库结构设计如下：</p>

<p>博文表：blog</p>

<pre><code class="language-shell">– id
– title
- content
</code></pre>

<p>标签表：tag</p>

<pre><code class="language-shell">- id
- name
</code></pre>

<p>博文和标签的关联表：blog_tag</p>

<pre><code class="language-shell">- blog_id
- tag_id
</code></pre>

<p>然后我们在模型中使用BelongsToMany()来使用中间表表示博文和标签关系<br/>
博文模型app/Blog.php:</p>

<pre><code class="language-php">&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Blog extends Model
{
    protected $table = &#39;blog&#39;;
    public $timestamps = false;

    public function tag()
    {
        return $this-&gt;belongsToMany(&#39;App\Tag&#39;);
    }
}
</code></pre>

<p>标签模型app/Tag.php:</p>

<pre><code class="language-php">&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Tag extends Model
{
    protected $table = &#39;tag&#39;;
    public $timestamps = false;

    public function blog()
    {
        return $this-&gt;belongsToMany(&#39;App\Blog&#39;);
    }
}
</code></pre>

<p>我们可以进一步指定中间表的表名和关联的字段:</p>

<pre><code class="language-php">&lt;?php

namespace App;

use Illuminate\Database\Eloquent\Model;

class Blog extends Model
{
    //
    protected $table = &#39;blog&#39;;
    public $timestamps = false;

    public function tag()
    {
        return $this-&gt;belongsToMany(&#39;App\Tag&#39;, &#39;blog_tag&#39;, &#39;blog_id&#39;, &#39;tag_id&#39;);
    }
}
</code></pre>

<p>博文新关联一个标签</p>

<pre><code class="language-php">$blog = Blog::find($blogId);
$blog-&gt;tag()-&gt;attach($tagId);// $tagId就是需要关联的标签的id
</code></pre>

<p>博文删除关联的一个标签</p>

<pre><code class="language-php">$blog = Blog::find($blogId);
$blog-&gt;tag()-&gt;detach($tagId);// $tagId就是需要删除的关联的标签的id
</code></pre>

<p>删除所有与标签的关联</p>

<pre><code class="language-php">$blog = Blog::find($blogId);
$blog-&gt;tag()-&gt;detach();
</code></pre>

<p>注意：attach和detach的参数都可以是一个数组，表示添加或者删除多个关联的标签。</p>

<p>博文使用新的标签关联替换原有的关联：</p>

<pre><code class="language-php">$blog-&gt;tag()-&gt;sync([1, 2, 3]);
</code></pre>

<h2 id="toc_0">参考资料</h2>

<p><a href="http://laraveldaily.com/pivot-tables-and-many-to-many-relationships/">Pivot tables and many-to-many relationships</a></p>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/3/15</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='laravel.html'>LARAVEL</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15582826489770.html">
                
                  <h1>mysql 常用命令</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<pre><code class="language-sql">set names utf8
source

select语句 into outfile &#39;外部文件路径&#39; fields terminated by &#39;|&#39; enclosed by &#39;&quot;&#39; lines terminated by &#39;\r\n&#39; ;
load data infile &#39;外部文件路径&#39; into table 表名 fields terminated by &#39;|&#39; enclosed by &#39;&quot;&#39; lines terminated by &#39;\r\n&#39; ;

mysqldump -u 用户名 -p 数据库名 &gt; 导出的文件名
mysqldump -u 用户名 -p 数据库名 表名&gt; 导出的文件名

只导出表结构
mysqldump -u 用户名 -p -d --add-drop-table 数据库名 &gt; 导出的文件名

mysqldump  -uroot -p --databases test mysql #空格分隔
mysqldump  -uroot -p -all-databases
mysql -uroot -proot test &lt; test.sql
</code></pre>

<h2 id="toc_0">查看锁等待</h2>

<pre><code class="language-sql">SELECT 
    r.trx_id waiting_trx_id,
    r.trx_mysql_thread_id waiting_thread,
    r.trx_query waiting_query,
    b.trx_id blocking_trx_id,
    b.trx_mysql_thread_id blocking_thread,
    b.trx_query blocking_query
FROM
    information_schema.innodb_lock_waits w
        INNER JOIN
    information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id
        INNER JOIN
    information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id;
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/3/10</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='sql.html'>SQL</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15582826206789.html">
                
                  <h1>FFMPEG获取视频播放时长</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<pre><code class="language-php">function video_info($file,$ffmpeg) {
    ob_start();
    passthru(sprintf($ffmpeg.&#39; -i &quot;%s&quot; 2&gt;&amp;1&#39;, $file));
    $info = ob_get_contents();
    ob_end_clean();
  // 通过使用输出缓冲，获取到ffmpeg所有输出的内容。
   $ret = array();
    // Duration: 01:24:12.73, start: 0.000000, bitrate: 456 kb/s
    if (preg_match(&quot;/Duration: (.*?), start: (.*?), bitrate: (\d*) kb\/s/&quot;, $info, $match)) {
        $ret[&#39;duration&#39;] = $match[1]; // 提取出播放时间
        $da = explode(&#39;:&#39;, $match[1]); 
        $ret[&#39;seconds&#39;] = $da[0] * 3600 + $da[1] * 60 + $da[2]; // 转换为秒
        $ret[&#39;start&#39;] = $match[2]; // 开始时间
        $ret[&#39;bitrate&#39;] = $match[3]; // bitrate 码率 单位 kb
    }

    // Stream #0.1: Video: rv40, yuv420p, 512x384, 355 kb/s, 12.05 fps, 12 tbr, 1k tbn, 12 tbc
    if (preg_match(&quot;/Video: (.*?), (.*?), (.*?)[,\s]/&quot;, $info, $match)) {
        $ret[&#39;vcodec&#39;] = $match[1]; // 编码格式
        $ret[&#39;vformat&#39;] = $match[2]; // 视频格式 
        $ret[&#39;resolution&#39;] = $match[3]; // 分辨率
        $a = explode(&#39;x&#39;, $match[3]);
        $ret[&#39;width&#39;] = $a[0];
        $ret[&#39;height&#39;] = $a[1];
    }

    // Stream #0.0: Audio: cook, 44100 Hz, stereo, s16, 96 kb/s
    if (preg_match(&quot;/Audio: (\w*), (\d*) Hz/&quot;, $info, $match)) {
        $ret[&#39;acodec&#39;] = $match[1];       // 音频编码
        $ret[&#39;asamplerate&#39;] = $match[2];  // 音频采样频率
    }

    if (isset($ret[&#39;seconds&#39;]) &amp;&amp; isset($ret[&#39;start&#39;])) {
        $ret[&#39;play_time&#39;] = $ret[&#39;seconds&#39;] + $ret[&#39;start&#39;]; // 实际播放时间
    }

    $ret[&#39;size&#39;] = filesize($file); // 文件大小
    return $ret;
}
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/3/7</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='php.html'>PHP</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15582825719147.html">
                
                  <h1>Yii提交表单出现bad request错误解决方案</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>在表单提交按钮之前添加如下代码：</p>

<pre><code class="language-php">&lt;?php echo \yii\helpers\Html::hiddenInput(Yii::$app-&gt;request-&gt;csrfParam, Yii::$app-&gt;request-&gt;getCsrfToken()) ?&gt;
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/3/1</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='yii.html'>Yii/Yii2</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15582824773265.html">
                
                  <h1>apache和nginx虚拟主机配置文件示例</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h2 id="toc_0">apache虚拟主机配置文件示例</h2>

<pre><code class="language-conf">&lt;VirtualHost *:80&gt;
 ServerName  test.com
 DocumentRoot  &quot;d:\www\test&quot;  
 DirectoryIndex   index.php
 &lt;Directory &quot;d:\www\qlmall&quot;&gt;
     Options +FollowSymLinks
     Order Allow,Deny
     allow from all
     AllowOverride All
 &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre>

<h2 id="toc_1">nginx配置文件示例</h2>

<pre><code class="language-conf">server {
    server_name test.com;
    listen 80;
    root /data/webroot/test;

        location = /favicon.ico {
                log_not_found off;
                access_log off;
        }

        location = /robots.txt {
                allow all;
                log_not_found off;
                access_log off;
        }

        location / {
            index index.php index.html index.htm;
                # This is cool because no php is touched for static content.
                # include the &quot;?$args&quot; part so non-default permalinks doesn&#39;t break when using query string
                try_files $uri $uri/ /index.php?$args;
        }

        location ~ \.php$ {
                #NOTE: You should have &quot;cgi.fix_pathinfo = 0;&quot; in php.ini
                include fastcgi.conf;
                fastcgi_intercept_errors on;
            fastcgi_pass 127.0.0.1:9000;
        }

        location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
                expires max;
                log_not_found off;
        }

    error_log /var/log/nginx/test.com.error.log;
    access_log /var/log/nginx/test.com.access.log;
}
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2017/2/28</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='apache-nginx.html'>Apache/Nginx</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   <a href="all_10.html">&laquo; Prev Page</a>  
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			 <a href="all_12.html">&raquo; Next Page</a> 
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <h1>xiaolin's blog</h1>
                <div class="site-des">core tech share blog</div>
                <div class="social">
                  <a target="_blank" class="juejin" href="https://juejin.im/user/5c409f86e51d4551c88027a2/posts" title="Juejin">juejin</a>









<a target="_blank" class="github" target="_blank" href="https://github.com/neatlife" title="GitHub">GitHub</a>

  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="macios.html"><strong>mac&ios</strong></a>
        
            <a href="lc.html"><strong>leetcode</strong></a>
        
            <a href="security.html"><strong>安全</strong></a>
        
            <a href="business.html"><strong>业务</strong></a>
        
            <a href="source-code.html"><strong>源码分析</strong></a>
        
            <a href="redis.html"><strong>Redis</strong></a>
        
            <a href="apache-nginx.html"><strong>Apache/Nginx</strong></a>
        
            <a href="spring-boot.html"><strong>Spring Boot</strong></a>
        
            <a href="pm.html"><strong>项目管理</strong></a>
        
            <a href="sql.html"><strong>SQL</strong></a>
        
            <a href="job-scheduler.html"><strong>任务调度</strong></a>
        
            <a href="design-pattern.html"><strong>设计模式</strong></a>
        
            <a href="mq.html"><strong>消息队列</strong></a>
        
            <a href="rpc.html"><strong>RPC</strong></a>
        
            <a href="laravel.html"><strong>LARAVEL</strong></a>
        
            <a href="tcp-ip.html"><strong>TCP/IP</strong></a>
        
            <a href="uml.html"><strong>UML</strong></a>
        
            <a href="service-mesh.html"><strong>SERVICE MESH</strong></a>
        
            <a href="ci-cd.html"><strong>CI/CD</strong></a>
        
            <a href="ops.html"><strong>OPS</strong></a>
        
            <a href="linux.html"><strong>LINUX</strong></a>
        
            <a href="system-programming.html"><strong>系统编程</strong></a>
        
            <a href="aws.html"><strong>AWS</strong></a>
        
            <a href="lua.html"><strong>LUA</strong></a>
        
            <a href="git.html"><strong>GIT</strong></a>
        
            <a href="js.html"><strong>js</strong></a>
        
            <a href="java.html"><strong>JAVA</strong></a>
        
            <a href="monitor.html"><strong>监控</strong></a>
        
            <a href="vim.html"><strong>VIM</strong></a>
        
            <a href="php.html"><strong>PHP</strong></a>
        
            <a href="openresty.html"><strong>OpenResty</strong></a>
        
            <a href="swoole.html"><strong>SWOOLE</strong></a>
        
            <a href="ons.html"><strong>消息队列</strong></a>
        
            <a href="gdb.html"><strong>GDB</strong></a>
        
            <a href="specification.html"><strong>规范</strong></a>
        
            <a href="3-minutes.html"><strong>三分钟系列</strong></a>
        
            <a href="1-pic.html"><strong>一图胜千言</strong></a>
        
            <a href="account-system.html"><strong>帐号系统</strong></a>
        
            <a href="interview.html"><strong>面试题</strong></a>
        
            <a href="yii.html"><strong>Yii/Yii2</strong></a>
        
            <a href="python.html"><strong>python</strong></a>
        
            <a href="go.html"><strong>GO</strong></a>
        
            <a href="ml.html"><strong>机器学习</strong></a>
        
            <a href="emacs.html"><strong>emacs</strong></a>
        
            <a href="bi.html"><strong>商业智能</strong></a>
        
            <a href="mac.html"><strong>mac</strong></a>
        
            <a href="editor.html"><strong>编辑器</strong></a>
        
            <a href="productive-soft.html"><strong>生产力工具</strong></a>
        
            <a href="driver-license.html"><strong>驾照</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="16081898834624.html">OSX使用代码代替storyboard构建项目，并添加NSSplitView组件</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="16005640944829.html">linux系统编程之多进程和管道（pip）</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15970226751276.html">三分钟上手java多线程控制技术</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15864793262262.html">14/24 设计模式之状态模式 State Pattern</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15880004262195.html">python高性能之路:使用C/C++编写扩展</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.
<span id="busuanzi_container_site_uv">访问<span id="busuanzi_value_site_uv"></span>人</span>/
        <span id="busuanzi_container_site_pv"><span id="busuanzi_value_site_pv"></span>次</span>
    </p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138141150-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138141150-1');
</script>

<canvas class="fireworks" 
        style="position: fixed; left: 0px; top: 0px; z-index: 99999999; pointer-events: none; width: 1158px; height: 916px;" 
        width="2316" 
        height="1832">
</canvas>
    <script src="asset/js/anime.min.js"></script>
    <script src="asset/js/fireworks.js"></script>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  </body>
</html>
